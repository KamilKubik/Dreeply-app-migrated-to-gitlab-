{"ast":null,"code":"import { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport _defineProperty from \"C:/off-saas/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _toConsumableArray from \"C:/off-saas/node_modules/next/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _regeneratorRuntime from \"C:/off-saas/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"C:/off-saas/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useState, useMemo, useEffect } from 'react';\nimport Image from 'next/image';\nimport { sections } from '../../../../../utils/business-plan';\nimport useSWR, { mutate } from 'swr';\nimport firebase, { db } from '../../../../../lib/firebase';\nimport { useAuth } from '../../../../../lib/newAuth';\nimport { useRouter } from 'next/router';\nimport fetcher from '../../../../../utils/fetcher';\n\nvar SectionManager = function SectionManager(_ref) {\n  var setSections1 = _ref.setSections1,\n      dataFromInput = _ref.dataFromInput,\n      setDataFromInput = _ref.setDataFromInput,\n      activeSection = _ref.activeSection,\n      setActiveSection = _ref.setActiveSection;\n\n  var _useState = useState(),\n      sections = _useState[0],\n      setSections = _useState[1];\n\n  var _useState2 = useState(),\n      inputValue = _useState2[0],\n      setInputValue = _useState2[1];\n\n  var _useState3 = useState(),\n      projectId = _useState3[0],\n      setProjectId = _useState3[1];\n\n  var _useAuth = useAuth(),\n      currentUser = _useAuth.currentUser;\n\n  var router = useRouter();\n  var ref = db.collection('currentBusinessPlan');\n  useEffect(function () {\n    // PROJECT ID\n    var gcp = /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return db.collection('projects').where('uid', '==', currentUser.uid).where('projectName', '==', router.query.project).get().then(function (querySnapshot) {\n                  querySnapshot.forEach(function (doc) {\n                    return setProjectId(doc.data().projectId);\n                  });\n                });\n\n              case 2:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      return function gcp() {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n\n    gcp();\n    ref.where('uid', '==', currentUser.uid).onSnapshot(function (querySnapshot) {\n      var items = [];\n      querySnapshot.forEach(function (doc) {\n        items.push.apply(items, _toConsumableArray(doc.data().sections));\n      });\n      setSections(items);\n    });\n  }, []); // const getProjectSections = () => {\n  //   const { data } = useSWR(\n  //     currentUser && projectId\n  //       ? [`/api/business-plan/${projectId}`, currentUser.token]\n  //       : null,\n  //     fetcher\n  //   );\n  //   useMemo(\n  //     () =>\n  //       data &&\n  //       data.map((project) => {\n  //         // useMemo jest po to, żeby nie było rerenderów (w sensie wyskakuje wtedy błąd, że za dużo renderowań)\n  //         setSections(project.sections);\n  //       }),\n  //     [data]\n  //   );\n  // };\n  // getProjectSections();\n\n  console.log('SECTIONS --> ', sections);\n\n  var onSectionAdd = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(e) {\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              e.preventDefault();\n              sections.push({\n                name: inputValue\n              });\n              ref.doc(currentUser.uid).set({\n                sections: sections\n              }, {\n                merge: true\n              }); // sections.push({ name: inputValue });\n              // await db.collection('currentBusinessPlan').doc(currentUser.uid).set({ sections }, { merge: true });\n              // console.log(sections);\n              // mutate([`/api/business-plan/${projectId}`, currentUser.token], sections);\n\n            case 3:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function onSectionAdd(_x) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var onSectionDelete = function onSectionDelete(e, name) {\n    e.preventDefault();\n    console.log(name);\n    var newSections = sections.filter(function (section) {\n      return section.name !== name;\n    });\n    console.log('NEW SECTIONS - ', newSections);\n    ref.doc(currentUser.uid).set({\n      sections: newSections\n    }, {\n      merge: true\n    });\n  };\n\n  useEffect(function () {\n    console.log(dataFromInput);\n  });\n  console.log('INPUT DATA --> ', dataFromInput);\n\n  var onSectionClick = /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(e, namer) {\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              e.preventDefault();\n\n              if (!(namer == activeSection)) {\n                _context3.next = 3;\n                break;\n              }\n\n              return _context3.abrupt(\"return\");\n\n            case 3:\n              if (!dataFromInput) {\n                _context3.next = 6;\n                break;\n              }\n\n              _context3.next = 6;\n              return db.collection('currentBusinessPlan').doc(currentUser.uid).collection('data').doc(activeSection).update({\n                values: firebase.firestore.FieldValue.arrayUnion(_objectSpread({\n                  id: 'e08855cc-fcbc-46a0-881c-c933d84bd962'\n                }, dataFromInput))\n              });\n\n            case 6:\n              // Nowa nazwa wybranej sekcji następuje po tym, jak dodamy data z aktualnego inputa, bo jak było przed tym, to data z inputa dodawało się do innej sekcji\n              // setSections1(null);\n              setActiveSection(namer); // Data input reset\n\n              setDataFromInput(null);\n\n            case 8:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    return function onSectionClick(_x2, _x3) {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  return /*#__PURE__*/_jsxs(\"div\", {\n    className: \"col-start-7 col-end-9 mt-12\",\n    children: [/*#__PURE__*/_jsx(\"h1\", {\n      className: \"ml-4 text-primarydark text-base dark:text-background\",\n      children: \"Manage your sections\"\n    }), /*#__PURE__*/_jsxs(\"div\", {\n      className: \"w-full ml-4 mt-1 bg-white flex flex-col py-2 px-4 rounded-2xl\",\n      children: [sections && sections.map(function (section) {\n        return /*#__PURE__*/_jsxs(\"div\", {\n          onClick: function onClick(e) {\n            return onSectionClick(e, section.name);\n          },\n          className: \"h-10 bg-background mt-4 rounded-2xl flex justify-around items-center transform hover:scale-105 hover:-translate-y-1 hover:-translate-x-1 transition duration-500 ease-in-out cursor-pointer\",\n          children: [/*#__PURE__*/_jsx(\"div\", {\n            children: /*#__PURE__*/_jsx(\"p\", {\n              className: \"text-primarydark text-sm\",\n              children: section.name\n            })\n          }), /*#__PURE__*/_jsx(Image, {\n            onClick: function onClick(e) {\n              return onSectionDelete(e, section.name);\n            },\n            src: \"/business-model/delete.svg\",\n            height: 20,\n            width: 20\n          })]\n        }, section.name);\n      }), /*#__PURE__*/_jsxs(\"div\", {\n        className: \"h-10 mt-4 rounded-2xl flex justify-around items-center\",\n        children: [/*#__PURE__*/_jsx(\"div\", {\n          children: /*#__PURE__*/_jsx(\"button\", {\n            onClick: function onClick(e) {\n              return onSectionAdd(e);\n            },\n            className: \"hover:bg-primary hover:text-white dark:hover:bg-primarydark dark:hover:text-background focus:outline-none border border-primary text-primary dark:text-primarydark dark:border-primarydark text-sm font-light py-2 px-6 rounded-2xl\",\n            children: \"New section\"\n          })\n        }), /*#__PURE__*/_jsx(\"input\", {\n          className: \"border border-primarydark\",\n          type: \"text\",\n          value: inputValue,\n          onChange: function onChange(e) {\n            return setInputValue(e.target.value);\n          }\n        })]\n      })]\n    })]\n  });\n};\n\nexport default SectionManager;","map":null,"metadata":{},"sourceType":"module"}